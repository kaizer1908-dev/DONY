<!--@css(/css/pop_swp.css)-->
<!--@js(/js/pop_swp.js)-->

<style>
/* ============================================
   듀얼 팝업 전용 스타일
============================================ */

/* 공통: 팝업 컨테이너 */
.dual-popup-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none; /* 배경 클릭 방지 */
    z-index: 9999;
}

/* PC: 중앙에 2개 나란히 배치 */
@media (min-width: 768px) {
    .dual-popup-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        gap: 20px; /* 팝업 간 간격 */
        pointer-events: auto;
    }
    
    .pop_swp {
        position: relative !important;
        top: auto !important;
        left: auto !important;
        transform: none !important;
        margin: 0 !important;
    }
    
    /* 딤드 효과는 하나만 표시 */
    .pop_swp:not(:first-child) .dimmed2 {
        display: none;
    }
}

/* 모바일: 스와이프 슬라이드 */
@media (max-width: 767px) {
    .dual-popup-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 400px;
        pointer-events: auto;
    }
    
    .mobile-swiper-container {
        position: relative;
        overflow: hidden;
    }
    
    .pop_swp {
        position: relative !important;
        top: auto !important;
        left: auto !important;
        transform: none !important;
        width: 100%;
    }
    
    /* 스와이프 인디케이터 */
    .mobile-pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 15px;
    }
    
    .mobile-pagination span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255,255,255,0.5);
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .mobile-pagination span.active {
        background: #fff;
        width: 24px;
        border-radius: 4px;
    }
    
    /* 딤드 효과는 하나만 표시 */
    .pop_swp:not(:first-child) .dimmed2 {
        display: none;
    }
}
</style>

<!-- 듀얼 팝업 컨테이너 -->
<div class="dual-popup-container" id="dualPopupContainer">
    <div class="dual-popup-wrapper" id="dualPopupWrapper">
        
        <!-- 팝업 1: popup-bnr -->
        <div class="pop_swp popup-left" df-banner-code="popup-bnr" hidden data-cookie-name="popupClose1">
            <div class="dimmed2"></div>
            <div class="pop-content">
                <div class="pop_swiper">
                    <ul class="swiper-wrapper">
                        <li class="swiper-slide" df-banner-clone>
                            <a href="{#href}" target="{#target}">{#item}</a>
                        </li>       
                    </ul>
                    <div class="swiper-pagination"></div>
                </div>
                <div class="closeInfo">
                    <a class="closeToday" data-popup="1">오늘 하루 보지 않기</a>
                    <a class="closePop" data-popup="1">닫기</a>
                </div>
            </div>
        </div>

        <!-- 팝업 2: popup-bnr2 -->
        <div class="pop_swp popup-right" df-banner-code="popup-bnr2" hidden data-cookie-name="popupClose2">
            <div class="dimmed2"></div>
            <div class="pop-content">
                <div class="pop_swiper">
                    <ul class="swiper-wrapper">
                        <li class="swiper-slide" df-banner-clone>
                            <a href="{#href}" target="{#target}">{#item}</a>
                        </li>       
                    </ul>
                    <div class="swiper-pagination"></div>
                </div>
                <div class="closeInfo">
                    <a class="closeToday" data-popup="2">오늘 하루 보지 않기</a>
                    <a class="closePop" data-popup="2">닫기</a>
                </div>
            </div>
        </div>

    </div>
    
    <!-- 모바일 전용 페이지네이션 -->
    <div class="mobile-pagination" style="display: none;">
        <span class="active" data-index="0"></span>
        <span data-index="1"></span>
    </div>
</div>

<script>
(function() {
    'use strict';
    
    // ==========================================
    // 쿠키 관리 함수
    // ==========================================
    function setCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }
    
    function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
    
    // ==========================================
    // 팝업 표시 여부 확인
    // ==========================================
    var popup1 = document.querySelector('.popup-left');
    var popup2 = document.querySelector('.popup-right');
    var container = document.getElementById('dualPopupContainer');
    
    var popup1Hidden = getCookie('popupClose1') === 'Y';
    var popup2Hidden = getCookie('popupClose2') === 'Y';
    
    // 두 팝업 모두 닫혀있으면 컨테이너 숨김
    if (popup1Hidden && popup2Hidden) {
        container.style.display = 'none';
    } else {
        // 각 팝업 표시
        if (!popup1Hidden && popup1) popup1.style.display = 'block';
        if (!popup2Hidden && popup2) popup2.style.display = 'block';
    }
    
    // ==========================================
    // 닫기 버튼 이벤트
    // ==========================================
    document.querySelectorAll('.closeToday').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var popupNum = this.getAttribute('data-popup');
            var cookieName = 'popupClose' + popupNum;
            var popupEl = popupNum === '1' ? popup1 : popup2;
            
            setCookie(cookieName, 'Y', 1);
            popupEl.style.display = 'none';
            
            // 두 팝업 모두 닫혔는지 확인
            checkAllClosed();
        });
    });
    
    document.querySelectorAll('.closePop').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var popupNum = this.getAttribute('data-popup');
            var popupEl = popupNum === '1' ? popup1 : popup2;
            
            popupEl.style.display = 'none';
            
            // 두 팝업 모두 닫혔는지 확인
            checkAllClosed();
        });
    });
    
    function checkAllClosed() {
        var popup1Display = popup1 ? window.getComputedStyle(popup1).display : 'none';
        var popup2Display = popup2 ? window.getComputedStyle(popup2).display : 'none';
        
        if (popup1Display === 'none' && popup2Display === 'none') {
            container.style.display = 'none';
        }
    }
    
    // ==========================================
    // 모바일: 스와이프 기능 구현
    // ==========================================
    if (window.innerWidth < 768) {
        var wrapper = document.getElementById('dualPopupWrapper');
        var pagination = document.querySelector('.mobile-pagination');
        var dots = pagination.querySelectorAll('span');
        
        pagination.style.display = 'flex';
        
        var currentIndex = 0;
        var startX = 0;
        var isDragging = false;
        
        // 초기 위치 설정
        function updatePosition(animated) {
            var popups = wrapper.querySelectorAll('.pop_swp');
            popups.forEach(function(popup, index) {
                if (animated) {
                    popup.style.transition = 'transform 0.3s ease-out';
                } else {
                    popup.style.transition = 'none';
                }
                
                if (index === currentIndex) {
                    popup.style.display = 'block';
                    popup.style.transform = 'translateX(0)';
                } else {
                    popup.style.transform = 'translateX(' + ((index - currentIndex) * 100) + '%)';
                    setTimeout(function() {
                        if (index !== currentIndex) {
                            popup.style.display = 'none';
                        }
                    }, animated ? 300 : 0);
                }
            });
            
            // 페이지네이션 업데이트
            dots.forEach(function(dot, index) {
                dot.classList.toggle('active', index === currentIndex);
            });
        }
        
        // 터치 이벤트
        wrapper.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
            isDragging = true;
        });
        
        wrapper.addEventListener('touchmove', function(e) {
            if (!isDragging) return;
            
            var currentX = e.touches[0].clientX;
            var diff = currentX - startX;
            
            wrapper.querySelectorAll('.pop_swp').forEach(function(popup, index) {
                popup.style.transition = 'none';
                var offset = ((index - currentIndex) * 100) + (diff / wrapper.offsetWidth * 100);
                popup.style.transform = 'translateX(' + offset + '%)';
            });
        });
        
        wrapper.addEventListener('touchend', function(e) {
            if (!isDragging) return;
            
            var endX = e.changedTouches[0].clientX;
            var diff = endX - startX;
            
            // 50px 이상 스와이프 시 전환
            if (Math.abs(diff) > 50) {
                if (diff > 0 && currentIndex > 0) {
                    currentIndex--;
                } else if (diff < 0 && currentIndex < 1) {
                    currentIndex++;
                }
            }
            
            updatePosition(true);
            isDragging = false;
        });
        
        // 페이지네이션 클릭
        dots.forEach(function(dot) {
            dot.addEventListener('click', function() {
                currentIndex = parseInt(this.getAttribute('data-index'));
                updatePosition(true);
            });
        });
        
        // 초기 표시
        updatePosition(false);
    }
    
})();
</script>